package com.code.listener;

import java.util.List;

import javax.servlet.ServletContext;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import javax.servlet.http.HttpSessionAttributeListener;
import javax.servlet.http.HttpSessionBindingEvent;

import org.springframework.context.ApplicationContext;
import org.springframework.web.context.support.WebApplicationContextUtils;

import com.code.entity.home.Config;
import com.code.service.home.HomeConfigService;

/**
 * 全局监听器
 * @author Jinx
 *
 */
public class WebListener  implements ServletContextListener, HttpSessionAttributeListener {


	public void contextDestroyed(ServletContextEvent event) {

	}

	/**
	 *存放容器全局变量
	 */
	public void contextInitialized(ServletContextEvent event) {
		ServletContext context = event.getServletContext();
		ApplicationContext ctx = WebApplicationContextUtils.getRequiredWebApplicationContext(context);
		//手动注入dao或者Service
		HomeConfigService configService =(HomeConfigService)ctx.getBean("homeConfigService");
		List<Config> list = configService.findUsed(1);
		if(null!=list&&!list.isEmpty()){
			for(Config cfg:list){
				context.setAttribute(cfg.getCode(),cfg.getValue());
			}
		}
	}


	public void attributeAdded(HttpSessionBindingEvent event) {
	}

	public void attributeRemoved(HttpSessionBindingEvent event) {
	}

	public void attributeReplaced(HttpSessionBindingEvent event) {

	}

	public void checkVersion() {
	}
}
